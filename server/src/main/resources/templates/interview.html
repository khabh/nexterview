<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AI 면접관</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetchCategories();
        });

        // 카테고리 가져오기
        async function fetchCategories() {
            const response = await fetch("/api/prompts");
            const categories = await response.json();
            const categorySelect = document.getElementById("category");

            categorySelect.innerHTML = ""; // 초기화
            categories.forEach(category => {
                const option = document.createElement("option");
                option.value = category.id;
                option.textContent = category.name;
                categorySelect.appendChild(option);
            });

            if (categories.length > 0) {
                fetchPrompts(categories[0].id); // 첫 번째 카테고리에 대한 질문 불러오기
            }
        }

        // 카테고리에 따른 질문 불러오기
        async function fetchPrompts(promptId) {
            const response = await fetch(`/api/prompts/${promptId}/questions`);
            const prompts = await response.json();
            const inputFields = document.getElementById("input-fields");
            inputFields.innerHTML = ""; // 기존 입력 필드 초기화

            prompts.forEach(prompt => {
                const div = document.createElement("div");
                div.classList.add("dynamic-input");

                const label = document.createElement("label");
                label.textContent = prompt.content;

                const textarea = document.createElement("textarea");
                textarea.name = `answer-${prompt.id}`;
                textarea.id = `answer-${prompt.id}`;
                textarea.rows = 3;

                div.appendChild(label);
                div.appendChild(textarea);
                inputFields.appendChild(div);
            });
        }

        // 면접 질문 생성하기
        async function submitForm(event) {
            event.preventDefault();

            const categoryId = document.getElementById("category").value;
            const inputs = document.querySelectorAll(".dynamic-input textarea");
            const answers = Array.from(inputs).map(input => ({
                promptQuestionId: input.id.split("-")[1],
                answer: input.value
            }));

            const requestData = {
                categoryId: categoryId,
                title: "면접 질문 생성 예시",  // 예시로 제목을 작성
                answers: answers
            };

            const response = await fetch("/api/interview", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(requestData)
            });

            const interviewQuestions = await response.json();
            displayInterviewQuestions(interviewQuestions);
        }

        // 생성된 면접 질문 표시
        function displayInterviewQuestions(interview) {
            const outputDiv = document.getElementById("output");
            outputDiv.innerHTML = "<h3>생성된 면접 질문</h3>";

            interview.dialogues.forEach(dialogue => {
                const questionElement = document.createElement("p");
                questionElement.textContent = dialogue.question;

                const answerElement = document.createElement("p");
                answerElement.textContent = `답변: ${dialogue.answer}`;

                outputDiv.appendChild(questionElement);
                outputDiv.appendChild(answerElement);
            });
        }
    </script>
</head>
<body>
<div class="container">
    <form onsubmit="submitForm(event)">
        <!-- 카테고리 선택 -->
        <div class="category-selection">
            <label for="category">질문 카테고리 선택:</label>
            <select id="category" onchange="fetchPrompts(this.value)">
                <option value="">카테고리 선택</option>
            </select>
        </div>

        <!-- 동적으로 생성될 입력 필드 -->
        <div id="input-fields" class="input-fields"></div>

        <!-- 제출 버튼 -->
        <button type="submit" class="submit-btn">면접 질문 생성</button>
    </form>

    <!-- 생성된 면접 질문 표시 -->
    <div id="output"></div>
</div>
</body>
</html>
